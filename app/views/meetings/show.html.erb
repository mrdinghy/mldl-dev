




<script>

    $('#new_meetingissue_modal').on('submit', function() {
        $('#new_report_model').modal('hide');
    })

    $('#meetingreport-x').on('submit', function() {
        $('#new_report_model').modal('hide');
    })

    <% @meetingactions.each do |agenda| %>
    <% modalid = '#meetingreport-' + agenda.id.to_s %>
    $('<%= modalid %>').on('submit', function() {
        $('#new_report_model').modal('hide');
    })
    <% end %>

    $(document).ready(function() {
        $('#agendatable').DataTable();
    } );
</script>


<style>


  .modal-addissue {
    width: 1200px;
  }
</style>

  <%# @meetingactions.each do |agenda| %>

  <%# issue = Issue.find(agenda.issue_id) %>
  <%# modalid = '#meetingreport-' + agenda.id.to_s %>

  .<%#= modalid %>

  <%# end %>




<script type="text/javascript">
    $(document).ready(function() {
        $(".chosen-select").select2();
    });

</script>



<div class="content-wrapper widerbox">


<%= link_to 'Back to Meetings', meetings_path %><br>
<h3><span style="color: #999">Meeting: </span><%= @meeting.meetingid %></h3>
        <div class="pull-right">
       </div>




  <div class="row">


        <div class="col-sm-10">
          <div class="panel panel-default">
            <div class="panel-heading">

              <%= link_to 'Edit/Set Agenda', edit_meeting_path(@meeting), :class => "btn btn-primary pull-right" %>
            </div>
            <div class="panel-body">
                 <div class="col-sm-4">

                      <p>
                      <strong>Meeting Start:</strong>
                      <%#=  @meeting.real_start.strftime("%m/%d/%y") %>
                      <%=  @meeting.real_start %>
                      </p>



                      <p>
                      <strong>Meeting Duration:</strong>
                      <%=  @meeting.duration %> Hours
                      </p>

                 </div>
              <div class="col-sm-4">
                  <p>
                  <strong>Location:</strong>
                  <%=  @meeting.location %>
                  </p>


                  <p>
                  <strong>Structure:</strong>
                  <%= link_to @meeting.structure do %><%= @meeting.structure.name %><% end %>
                  <%= @meeting.structure.structuretype_humanize %>

                  </p>
                </div>





            </div>
          </div>


            </div>


      <div class="col-sm-10">





        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#viewissues">Agenda</a></li>
          <li><a data-toggle="tab" href="#viewparticipants">Participants</a></li>
          <li><a data-toggle="tab" href="#viewdocuments">Documents</a></li>

        </ul>

        <div class="tab-content">
          <div id="viewissues" class="tab-pane fade in active">
            <h3>Meeting Agenda</h3>
            <div class="panel panel-default">
              <div class="panel-heading">Agenda Issues</div>
              <div class="panel-body">

                <table id="agendatable"  class="table table-striped hover">
                  <thead>
                  <tr>

                    <th>Issue</th>
                    <th>Disputant</th>
                    <th>Meeting Results</th>
                    <th>District</th>
                    <th>Report</th>

                  </tr>
                  </thead>

                  <tbody>
                  <% @meetingactions.each do |agenda| %>
                      <% issue = Issue.find(agenda.issue.id) %>
                      <% results = Issueaction.where('issue_id =? and meeting_id = ? and actiontype <> 2', agenda.issue_id, @meeting.id ) %>

                      <% modalid = '#meetingreport-' + agenda.issue.id.to_s %>
                      <tr>

                        <td><%= link_to issue.issuecode, issue %></td>
                        <td><%= issue.disputant %></td>
                        <td><small>
                          <% results.each do |r| %>
                             <%= r.actiontype_humanize %> : <%= r.created_at.strftime("%m/  %d/%Y") %><br>
                          <% end %>

                          </small>
                        </td>
                        <td><%= issue.district.name if issue.district_id %></td>
                        <td>
                          <% if results.count != 0 %>
                              <%= link_to 'Revise',  modalid, 'data-toggle' => 'modal', :class => "btn btn-success" %>
                          <% else %>
                              <%= link_to 'Report',  modalid, 'data-toggle' => 'modal', :class => "btn btn-primary" %>
                          <% end %>

                        </td>


                      </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>
            </div>

          </div>
          <div id="viewparticipants" class="tab-pane fade">
            <h3>Meeting Participants</h3>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">Participants</h3>
                <%= link_to 'Add Participant', '#new_participant_modal', 'data-toggle' => 'modal', :class => "btn btn-success pull-right" %>
              </div>
              <div class="panel-body">

                <table class="table">
                  <thead>
                  <th>Name</th>
                  <th>Title</th>
                  <th>Organization</th>

                  </thead>
                  <tbody>
                  <% @participants.each do |p| %>
                      <tr>
                        <td>  <%= link_to p.person.fullname, p.person %> </td>
                        <td><%= p.person.title %></td>
                        <td><%= p.person.email %></td>
                        <td><%= p.person.phone %></td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>

             <small>Add Participant to Meeting</small><br>
             <%= render 'addparticipant' %>







              </div>

            </div>





          </div>
          <div id="viewdocuments" class="tab-pane fade">
            <h3>Documents</h3>



            <table class="table">

              <% @meetingdocs.each do |doc| %>
                  <tr>

                    <td>
                      <%= link_to doc.document_file_name , doc.document.url(:original, false) %>
                    </td>
                    <td>
                      <%= doc.document_updated_at %><br>
                    </td>
                  </tr>

              <% end %>
            </table>

            <%= simple_form_for @new_site_document do |form| %>
                <%= form.hidden_field :documentable_id, :value => @meeting.id %>
                <%= form.hidden_field :documentable_type, :value => 'meeting' %>
                <%= form.input :document, as: :file, :label => false %>
                <%= form.button :submit, :value => 'Upload Document', :class => "mb-sm btn btn-primary" %>
            <% end %>









          </div>





              </div>





      </div>



    <div class="col-sm-2">

      <div class="btn-group-vertical">






        <%= link_to 'New Issue', '#new_meetingissue_modal', 'data-toggle' => 'modal', :class => "btn btn-success" %><br><br>

        <button class="btn btn-default">Print Attendance Sheet</button><br>
        <button class="btn btn-default">Print Meeting Form</button><br>
        <button class="btn btn-default">Print Issue Forms</button><br>



      </div>j
    </div>





  </div>

  <div>

    <%= link_to 'Delete', @meeting, method: :delete, data: { confirm: 'Are you sure?' } , :class => "btn btn-danger" %>
  </div>

</div>



<script>
    $(document).ready(function() {
        $('#agenda').DataTable();
    } );
</script>




<div class="modal fade" id="new_meetingissue_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-addissue">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <small>Add New Issue to Meeting Agenda</small><br>
          <h4 class="modal-title" id="myModalLabel"><%= @meeting.id %></h4>
        </div>
        <div class="modal-body">
          <%= render 'addmeetingissues', modal: true %>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>




  <div class="modal fade" id="new_participant_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-addissue">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <small>Add New Attendee to Meeting Agenda</small><br>
          <h4 class="modal-title" id="myModalLabel"><%= @meeting.id %></h4>
        </div>
        <div class="modal-body">
          <%= render 'addparticipant', modal: true %>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>



  <% @meetingactions.each do |agenda| %>
      <% modalid = 'meetingreport-' + agenda.issue.id.to_s %>
      <div class="modal fade" id="<%= modalid %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-addissue">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <small>Report out from meeting</small><br>
              <h4 class="modal-title" id="myModalLabel"><%= agenda.id %></h4>
            </div>
            <div class="modal-body">
              <%= render partial: "meetingreportout", locals: {issue_id: agenda.issue.id} %>

            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

          </div>
        </div>
      </div>

    <% end %>




