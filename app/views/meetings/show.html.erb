




<script>

    $('#new_meetingissue_modal').on('submit', function() {
        $('#new_report_model').modal('hide');
    })

    $('#meetingreport-x').on('submit', function() {
        $('#new_report_model').modal('hide');
    })

    <% @meetingactions.each do |agenda| %>
    <% modalid = '#meetingreport-' + agenda.id.to_s %>
    $('<%= modalid %>').on('submit', function() {
        $('#new_report_model').modal('hide');
    })
    <% end %>

    $(document).ready(function() {
        $('#agendatable').DataTable();
    } );
</script>









<style>

  .modal-addperson {
    width: 600px;
  }

  .modal-addissue {
    width: 1200px;
  }


  <%# @meetingactions.each do |agenda| %>

  <%# issue = Issue.find(agenda.issue_id) %>
  <%# modalid = '#meetingreport-' + agenda.id.to_s %>

  .<%#= modalid %>

  <%# end %>










</style>

<div class="container">




  <div class="row">
    <div class="col-sm-12">


      <%= link_to 'Back to Meetings', meetings_path %><br>
      <h1>
        <span style="color: #999">Meeting: </span>Meeting: <%= @meeting.meetingid %>
        <div class="pull-right">
         </div>


      </h1>

    </div>
  </div>












  <div class="row">


        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">General</h3>
              <%= link_to 'Edit/Set Agenda', edit_meeting_path(@meeting), :class => "btn btn-primary pull-right" %>
            </div>
            <div class="panel-body">


                  <p>
                  <strong>Meeting Start:</strong>
                  <%#=  @meeting.real_start.strftime("%m/%d/%y") %>
                  <%=  @meeting.real_start %>
                  </p>



                  <p>
                  <strong>Meeting End:</strong>
                  <%=  @meeting.real_end %>
                  </p>


                  <p>
                  <strong>Location:</strong>
                  <%=  @meeting.location %>
                  </p>



                  <p>
                  <strong>Name:</strong>
                  <%= @meeting.name %>
                  </p>

                  <p>
                  <strong>Structure:</strong>
                  <%= link_to @meeting.structure do %><%= @meeting.structure.name %><% end %>
                  <%= @meeting.structure.structuretype_humanize %>

                  </p>

              <a data-toggle="modal" class="btn btn-default" href="#meetingreport-18">Report</a>



              <div class="form-group">
                <label class="col-sm-2">Documents</label>
                <div class="col-sm-10">
                  <table class="table">

                    <% @meetingdocs.each do |doc| %>
                        <tr>

                          <td>
                            <%= link_to doc.document_file_name , doc.document.url(:original, false) %>
                          </td>
                          <td>
                            <%= doc.document_updated_at %><br>
                          </td>
                        </tr>

                    <% end %>
                  </table>

                  <%= simple_form_for @new_site_document do |form| %>
                      <%= form.hidden_field :documentable_id, :value => @meeting.id %>
                      <%= form.hidden_field :documentable_type, :value => 'meeting' %>
                      <%= form.input :document, as: :file, :label => false %>
                      <%= form.button :submit, :value => 'Upload Document', :class => "mb-sm btn btn-primary" %>
                  <% end %>

                </div>
              </div>

<div class="pull-right">

              <%= link_to 'Delete', @meeting, method: :delete, data: { confirm: 'Are you sure?' } , :class => "btn btn-danger" %>
</div>
            </div>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Participants</h3>
              <%= link_to 'Add Participant', '#new_participant_modal', 'data-toggle' => 'modal', :class => "btn btn-success pull-right" %>
            </div>
            <div class="panel-body">

              <table class="table">
                <thead>
                <th>Name</th>
                <th>Title</th>
                <th>Organization</th>

                </thead>
                <tbody>
                <% @participants.each do |p| %>
                    <tr>
                      <td>  <%= link_to p.person.fullname, p.person %> </td>
                      <td><%= p.person.title %></td>
                      <td><%= p.person.email %></td>
                      <td><%= p.person.phone %></td>
                    </tr>
                <% end %>
                </tbody>
              </table>


            </div>

          </div>
            </div>


      <div class="col-sm-6">

        <div class="panel panel-default">
          <div class="panel-heading">Agenda Issues</div>
          <div class="panel-body">

            <table id="agendatable"  class="hover" cellspacing="0" width="100%">
              <thead>
              <tr>

                <th>Issue</th>
                <th>Disputant</th>
                <th>Meeting Results</th>

                <th>District</th>
                <th>Report</th>

              </tr>
              </thead>

              <tbody>
              <% @meetingactions.each do |agenda| %>
                  <% issue = Issue.find(agenda.issue.id) %>
                  <% results = Issueaction.where('issue_id =? and meeting_id = ? and actiontype > 0', agenda.issue_id, @meeting.id ) %>
                  <% modalid = '#meetingreport-' + agenda.issue.id.to_s %>
                  <tr>

                    <td><%= link_to issue.name, issue %> [<%= issue.id %>]</td>
                    <td><%= issue.disputant %></td>
                    <td>
                    <% results.each do |r| %>
                          <%= r.actiontype_humanize %><br>
                    <% end %>


                    </td>
                    <td><%= issue.district.name if issue.district_id %></td>
                    <td>
                      <% if results.count > 0 %>
                          <%= link_to 'Revise',  modalid, 'data-toggle' => 'modal', :class => "btn btn-success" %>
                          <% else %>
                      <%= link_to 'Report',  modalid, 'data-toggle' => 'modal', :class => "btn btn-primary" %>
                        <% end %>

                    </td>


                  </tr>
              <% end %>
              </tbody>
            </table>
          </div>
        </div>


      </div>



      <div class="col-sm-2">

      <div class="btn-group-vertical" role="group" aria-label="...">






      <%= link_to 'New Issue (M)', '#new_meetingissue_modal', 'data-toggle' => 'modal', :class => "btn btn-success" %><br><br>

      <button class="btn btn-default">Print Attendance Sheet</button><br>
      <button class="btn btn-default">Print Meeting Form</button><br>
      <button class="btn btn-default">Print Issue Forms</button><br>



      </div>







      </div>
  </div>




</div>




  <div class="modal fade" id="new_meetingissue_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-addissue">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <small>Add New Issue to Meeting Agenda</small><br>
          <h4 class="modal-title" id="myModalLabel"><%= @meeting.id %></h4>
        </div>
        <div class="modal-body">
          <%= render 'addmeetingissues', modal: true %>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>




  <div class="modal fade" id="new_participant_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-addissue">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <small>Add New Attendee to Meeting Agenda</small><br>
          <h4 class="modal-title" id="myModalLabel"><%= @meeting.id %></h4>
        </div>
        <div class="modal-body">
          <%= render 'addparticipant', modal: true %>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>



  <% @meetingactions.each do |agenda| %>
      <% modalid = 'meetingreport-' + agenda.issue.id.to_s %>
      <div class="modal fade" id="<%= modalid %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-addissue">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <small>Report out from meeting</small><br>
              <h4 class="modal-title" id="myModalLabel"><%= agenda.id %></h4>
            </div>
            <div class="modal-body">
              <%= render partial: "meetingreportout", locals: {issue_id: agenda.issue.id} %>

            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

          </div>
        </div>
      </div>

    <% end %>




