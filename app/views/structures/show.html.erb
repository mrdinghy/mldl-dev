







<style>

.modal-addmeeting {
width: 800px;
}
.modal-addissue {
width: 800px;
}

</style>





<script type="text/javascript">
  $(document).ready(function() {
    $(".chosen-select").select2();
  });

</script>




<!-- Page content-->
<%= debug @canedit %>

    <%= link_to 'Return to Structures', structures_path %>

    <h4 class="page-header"><span style="color: #999">Structure: </span><%= @structure.name %></h4>
    <!-- START row-->
<% if @canedit %>
    <div class="pull-right">
      <%= link_to 'New Issue', new_issue_path(:structure_id => @structure.id), :class => "btn btn-success"  %>
      <%#= link_to 'New Issue', '#new_issue_modal', 'data-toggle' => 'modal', :class => "btn btn-success" %>
      <%= link_to "New Meeting", new_meeting_path(:structure_id => @structure.id), :class => "btn btn-success" %>
    </div>
<% end %>


  <div class="row">


        <div class="col-sm-12">




          <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#viewissues">Issues</a></li>
            <li><a data-toggle="tab" href="#viewgeneral">General</a></li>
            <li><a data-toggle="tab" href="#viewmeetings">Meetings</a></li>
            <li><a data-toggle="tab" href="#viewmediations">Mediations</a></li>
            <li><a data-toggle="tab" href="#viewmembers">Members</a></li>
          </ul>

          <div class="tab-content">
            <div id="viewgeneral" class="tab-pane fade">
              <h3><%= @structure.name %> - General</h3>
              <%= render partial: 'structures/general' %>
            </div>
            <div id="viewissues" class="tab-pane fade in active">
              <h3><%= @structure.name %> Issues</h3>
              <%= render partial: 'issues/issues_table' %>
            </div>
            <div id="viewmeetings" class="tab-pane fade">
              <h3><%= @structure.name %> Meetings</h3>
              <%= render partial: 'meetings/meetings_table' %>
            </div>
            <div id="viewmediations" class="tab-pane fade">
              <h3><%= @structure.name %> Mediations</h3>
              <%= render partial: 'mediations/mediations_table' %>
            </div>
            <div id="viewmembers" class="tab-pane fade">
              <h3><%= @structure.name %> Members</h3>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">People (non Users linked to Structure)</h3>
                  <%#= link_to 'Add Person', '#new_person_modal', 'data-toggle' => 'modal', :class => "btn btn-success pull-right" %>
                </div>
                <div class="panel-body">

                  <table class="table">
                    <thead>
                    <th>Name</th>
                    <th>Organization/Title</th>
                    <th>Email</th>

                    </thead>
                    <tbody>
                    <% @mypeople.each do |p| %>
                        <tr>
                          <td>  <%= link_to p.person.fullname, p.person %> </td>
                          <td><small><%= p.person.organization.name if p.person.organization_id %></small><br><%= p.person.title %></td>
                          <td><%= p.person.email %></td>

                        </tr>
                    <% end %>
                    </tbody>
                  </table>

                  <hr>
                  <% if @canedit %>
                    <small>Link Person to Structure</small><br>
                    <%= render 'addmember' %>


                  <% end %>

                  <script type="text/javascript">
                    $(document).ready(function() {
                      $(".js-example-basic-single").select2();
                    });

                  </script>

                </div>

              </div>
            </div>
          </div>










        </div>
  </div>









      </div>






<div class="modal fade" id="new_mgmt_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-addmgmt">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <small>Add Management to Structure</small><br>
        <h4 class="modal-title" id="myModalLabel"><%= @structure.name %></h4>
      </div>
      <div class="modal-body">
        <%= render 'addmanager', modal: true %>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="new_issue_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-addmeeting">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <small>Add New Issue to Structure</small><br>
        <h4 class="modal-title" id="myModalLabel"><%= @structure.name %></h4>

        <div id="error_explanation" style="display:none;">
      </div>
      <div class="modal-body">
        <%= render 'addstructureissue', modal: true %>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="new_meeting_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-addmeeting">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <small>Add New Structure Meeting</small><br>
        <h4 class="modal-title" id="myModalLabel"><%= @structure.name %></h4>
      </div>
      <div class="modal-body">
        <%= render 'addstructuremeeting', modal: true %>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>











<script>


    $('#new_mgmt_modal').on('submit', function() {
      $('#new_mgmt_modal').modal('hide');
    })


    $('#new_issue_modal').on('submit', function() {
      $('#new_issue_modal').modal('hide');
    })

    $('#new_meeting_modal').on('submit', function() {
      $('#new_meeting_modal').modal('hide');
    })


  </script>




